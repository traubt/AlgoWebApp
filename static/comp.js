function test_history(){$.ajax({method:"POST",url:"t.php"}).done(function(t){t.length<500&&(historical_data=!1)})}function get_symbol_historyP(t){if(historical_data)try{begin=new Date("2013-01-01"),end=new Date;begin.getUTCMonth(),begin.getUTCDate(),begin.getUTCFullYear(),end.getUTCMonth(),end.getUTCDate(),end.getUTCFullYear();$.ajax({method:"POST",url:"quotes.php",data:{symbol:t,content:"BPT",content_tp:"NA"}}).done(function(e){try{var r=JSON.parse(JSON.parse(e)),o=initialize_two_dim_array(r.chart.result[0].timestamp.length,2);r.chart.result[0].timestamp.map(function(t,e){o._data[e][0]=t}),r.chart.result[0].indicators.quote[0].close.map(function(t,e){o._data[e][1]=t}),o._data=stable_prices(o._data),create_chart_data(o._data),tickers_history_quotes[t]=o._data,symbol_data2(t,"chart"),$("#SearchSymbol").prop("disabled",!0),$("#RadioSample").prop("checked")||$("#add2portfolio").show(),chart_symbols=[],chart_symbols.push(selected_symbol)}catch(t){dialog("Error","Can't get historic quotes from webservice.\nPlease try again later.",BootstrapDialog.TYPE_DANGER),$("#add2portfolio").hide(),$("#SymbolChart").empty()}})}catch(t){dialog("Error","Can't get historic quotes from webservice.\nPlease try again later.",BootstrapDialog.TYPE_DANGER),$("#add2portfolio").hide(),$("#SymbolChart").empty()}else dialog("Webservice Not Available","Can't get historic quotes from webservice.\nPlease try again later.",BootstrapDialog.TYPE_INFO)}function get_symbol_news(t){$.ajax({method:"POST",url:"quotes.php",data:{symbol:t,content:"NEWS",content_tp:"NA"}}).done(function(t){console.log(t)})}function get_symbol_current_quote5(t){try{var e='["'+t+'"]';$.ajax({method:"POST",url:"quotes5.php",data:{url:"NA",content:e,content_tp:"NA"}}).done(function(e){if(console.log("get_symbol_current_quote5 - ajax successful"),single_quote_r=JSON.parse(e),single_quote_r){current_quote=flattenObject(JSON.parse(JSON.parse(single_quote_r[t])));var r="",o=current_quote["quoteSummary.result.0.price.longName"],a=current_quote["quoteSummary.result.0.price.symbol"],i=moment.unix(current_quote["quoteSummary.result.0.price.regularMarketTime"]).format("YYYY-MM-DD"),n=moment.unix(current_quote["quoteSummary.result.0.price.regularMarketTime"]).format("h:mma"),l=current_quote["quoteSummary.result.0.price.regularMarketPrice.raw"],s=current_quote["quoteSummary.result.0.price.regularMarketChange.fmt"],_=current_quote["quoteSummary.result.0.price.regularMarketChangePercent.fmt"],c=current_quote["quoteSummary.result.0.price.quoteType"],u=current_quote["quoteSummary.result.0.price.exchange"];if(o){reset_quote(),$(".companyName").text(o),$("#symbol_name").append(company_name+" ("+a+")"),$("#exchange_info").append("Type: "+c+".   Exchange: "+u+", \t\t\t\t\t\tLast Trade: "+moment(i).format("dddd, MMMM Do YYYY")+", at: "+n),$("#RadioSample").prop("checked")||$("#add2portfolio").css("visibility","visible"),$("#quote").append(l),$("#change").append(" "+ns(s)+" ("+_+")"),numeral(s)._value>=0?$("#change").css("color","#00cc00"):$("#change").css("color","red");for(var d=0;d<ind_arr.length;d++)r=r+"<tr>\t\t\t\t\t\t\t\t\t\t\t<td>"+indicators[ind_arr[d]]+"</td>\t\t\t\t\t\t\t\t\t\t\t<td>"+current_quote[ind_arr[d]]+"</td>\t\t\t\t\t\t\t\t\t\t</tr>";$("#quote_tbl tbody").append(r),$("#SearchSymbol").prop("disabled",!0),-1!=get_table_column(tb1,1).indexOf(a)||$("#RadioSample").prop("checked")||$("#add2portfolio").show()}else dialog("No quote found","No current quote found for symbol: "+$("#1").val(),BootstrapDialog.TYPE_INFO),$("#add2portfolio").hide(),$("#SymbolChart").empty()}else dialog("No quote found","No current quote found for symbol: "+$("#1").val(),BootstrapDialog.TYPE_INFO),$("#add2portfolio").hide(),$("#SymbolChart").empty()})}catch(t){dialog("Error","Can't get currents quotes from webservice.\nPlease try again later.",BootstrapDialog.TYPE_DANGER),$("#add2portfolio").hide(),$("#SymbolChart").empty()}}function handle_footer(){var t=tb1.column(1),e=tb1.column(10),r=tb1.column(11),o=tb1.column(12),a=tb1.column(13),i=tb1.column(14),l=tb1.column(15);tbRows>0?($("#combobox").val()?base_currency=$("#combobox").val():base_currency=get_table_column(tb1,7)[0],$(tb1.column(0).footer()).text("Count:"),$(t.footer()).text(tbRows),c_today>0?$(e.footer()).html(1===tbRows?ps(e.data()[0]):ps(e.data().splice(0,tbRows).reduce(function(t,e){return numeral(t)._value+numeral(e)._value})/c_today)):$(e.footer()).text("0.00%"),1==curr_arr.length?$(r.footer()).html(1===tbRows?CurrFull[curr_arr[0]].symbol+n(r.data()[0]):CurrFull[curr_arr[0]].symbol+n(r.data().splice(0,tbRows).reduce(function(t,e){return numeral(t)._value+numeral(e)._value}))):$(r.footer()).html("Multiple Currencies"),$(o.footer()).html(1===tbRows?ps(o.data()[0]):ps(o.data().splice(0,tbRows).reduce(function(t,e){return numeral(t)._value+numeral(e)._value})/tbRows)),$(a.footer()).html(1===tbRows?CurrFull[base_currency].symbol+n(a.data()[0]):CurrFull[base_currency].symbol+n(a.data().splice(0,tbRows).reduce(function(t,e){return numeral(t)._value+numeral(e)._value}))),$(i.footer()).html(""),$(i.footer()).html(CurrFull[base_currency].symbol+n(i.data().reduce(function(t,e){return n(numeral(t)._value+numeral(e)._value)}))),$(l.footer()).html(numeral(l.data().splice(0,tbRows).reduce(function(t,e){return numeral(t)._value+numeral(e)._value})).format("%0"))):($(e.footer()).html("Average"),$(r.footer()).html("NA"),$(o.footer()).html("NA"),$(a.footer()).html("Average"),$(i.footer()).html("Total"),$(l.footer()).html("Total"))}function dialog(t,e,r){BootstrapDialog.show({type:r,title:t,message:e,buttons:[{label:"Close",action:function(t){t.close()}}]})}function get_history2(){try{var t;get_current_quotes5(ticker_list_arr,"quotes"),begin=new Date("2013-01-01"),end=new Date,t=$(ticker_list_arr).not(Object.keys(tickers_history_quotes)).get();var e=JSON.stringify(t);t.length&&(console.log("get_history2: Calling ajax get stock history"),$.ajax({method:"POST",url:"mult2.php",data:{url:"dummy URL",symbols_arr:e}}).done(function(e){console.log("get_history2: Complete loading  stock history"),console.timeEnd("get_history2");try{promised_m=JSON.parse(e),$.each(t,function(t,e){var r=JSON.parse(JSON.parse(promised_m[e])),o=initialize_two_dim_array(r.chart.result[0].timestamp.length,2);r.chart.result[0].timestamp.map(function(t,e){o._data[e][0]=t}),r.chart.result[0].indicators.quote[0].close.map(function(t,e){o._data[e][1]=t}),input_history_quote[e]=o._data,o._data=stable_prices(o._data),tickers_history_quotes[e]=o._data})}catch(t){dialog("Timeout Error","\nCould not get data from webservice. \n\nPlease try again later.",BootstrapDialog.TYPE_DANGER),$("#buildPortfolio").addClass("btn btn-danger"),$("#buildPortfolio").text("No Portfolio"),$("#buildPortfolio i").remove()}}))}catch(t){console.log("error at get history line 295"),$("#buildPortfolio i").remove(),dialog("Oops...",t+"\n\nCan't get current quotes from webservice.\nPlease try again later.",BootstrapDialog.TYPE_DANGER)}}function create_monthly_array(t,e){try{var r,o,a=t[0][0],i=t[t.length-1][0],n=[];n=initialize_two_dim_array((r=create_date_range_arr(a,i)).length,2);return $.each(r,function(e,a){search_month=a,o=t.find(find_closest_month),n._data[e][0]=r[e],n._data[e][1]=o[1],e==interval-1&&(n._data[e][0]=i,n._data[e][1]=t[t-1][1])}),n._data}catch(t){console.log("error in get_historic_data2.create_monthly_array line 348"),dialog("Error",t+"\n\nCan't get currents quotes from webservice for stock: "+e+".\nPlease try again later or remove stock from portfolio.",BootstrapDialog.TYPE_DANGER)}}function sliceFromDate(t,e,r){return moment(t[0])._d>=moment(begin)._d?e:0}function sliceToDate(t,e,r){return moment(t[0])._d<=moment(end)._d?e:0}function create_portfolio_obj2(){try{portfolio.info={},ticker_quote={},json_quotes=[],csv_arr_full=[],csv_arr=[];var t=[];begin=new Date($("#from_date").val()),end=new Date($("#to_date").val()),monte_carlo_obj={};var e=[];$.each(portfolio._ticker_list,function(r,o){var a=tickers_history_quotes[o];if(a&&a.length>100){var i=initialize_two_dim_array(a.length,2);a.map(function(t,e){i._data[e][0]=moment.unix(t[0]).format("YYYY-MM-DD"),i._data[e][1]=t[1]}),csv_arr_full=i._data,i._data=stable_prices(i._data);var n=csv_arr_full.findIndex(sliceFromDate),l=csv_arr_full.length-csv_arr_full.reverse().findIndex(sliceToDate)+1;csv_arr_full.reverse(),csv_arr=csv_arr_full.slice(n,l),vector_arr=create_vector_arr(csv_arr),growth_arr=create_growth_vector_arr(vector_arr),ticker_quote.daily_prices=csv_arr,ticker_quote.Symbol=o,ticker_quote.raw_data=csv_arr_full,ticker_quote.prices_arr=vector_arr,ticker_quote.prices_std=vector_stdev(vector_arr),ticker_quote.prices_mean=vector_mean(vector_arr),ticker_quote.growth_arr=growth_arr,ticker_quote.daily_growth_mean=vector_mean(growth_arr),ticker_quote.daily_growth_std=vector_stdev(growth_arr),ticker_quote.daily_growth_drift=ticker_quote.daily_growth_mean-Math.pow(ticker_quote.daily_growth_std,2)/2,ticker_quote.daily_growth_count=growth_arr.length,ticker_quote.total_growth=vector_arr[vector_arr.length-1]/vector_arr[0]-1,ticker_quote.monte_strike_price=ticker_quote.prices_arr[ticker_quote.prices_arr.length-1],ticker_quote.monte_carlo=monte_carlo_simulation(ticker_quote.monte_strike_price,ticker_quote.daily_growth_drift,ticker_quote.daily_growth_std),e=create_monthly_array(csv_arr,o),vector_arr=create_vector_arr(e),growth_arr=create_growth_vector_arr(vector_arr),ticker_quote.range_data=e,ticker_quote.range_vector_arr=vector_arr,ticker_quote.range_growth_arr=growth_arr,ticker_quote.growth_mean=vector_mean(growth_arr),ticker_quote.growth_std=vector_stdev(growth_arr),ticker_quote.s_ratio=(ticker_quote.growth_mean-.001)/ticker_quote.growth_std,ticker_quote.t_ratio=ticker_quote.total_growth/ticker_quote.growth_std,ticker_quote.growth_drift=ticker_quote.growth_mean-Math.pow(ticker_quote.growth_std,2)/2,ticker_quote.s_ratio>=.65||"SAMPLE"==$("#market_select").val()?(json_quotes.push(ticker_quote),portfolio.info=json_quotes):t.push(o),delete ticker_quote,ticker_quote={},csv_arr=[],monte_carlo_obj={}}else t.push(o)}),t.length>0&&remove_ticker_from_portfolio2(t)}catch(t){console.log("Create Portfolio Error"),dialog("Error: "+symbol,t+"\n\nSymbol will be removed from portfolio",BootstrapDialog.TYPE_DANGER)}}function get_current_quotes4sugg(t,e){var r='["'+(t=t.filter(function(t){return null!=t})).join('","')+'"]';console.log("get_current_quotes4sugg: - Calling ajax get latest quotes"),$.ajax({method:"POST",url:"quotes5.php",data:{url:"NA",content:r,content_tp:e}}).done(function(e){for(console.log("get_current_quotes4sugg: - Complete loading latest quotes"),latest_quotes=JSON.parse(e),global={},i=0;i<t.length;i++)current_quote=flattenObject(JSON.parse(JSON.parse(latest_quotes[t[i]]))),global[t[i]]=current_quote})}function get_current_quotes5(t,e){var r='["'+(t=t.filter(function(t){return null!=t})).join('","')+'"]';console.log("get_current_quotes5: - Calling ajax get latest quotes"),$.ajax({method:"POST",url:"quotes5.php",data:{url:"NA",content:r,content_tp:e}}).done(function(t){if(console.log("get_current_quotes5: - Complete loading latest quotes"),latest_quotes=JSON.parse(t),tb1){for(hide_pf(),c_today=0,i=0;i<tb1.column(1).data().length;i++){var e=tb1.cell(i,1).data();current_quote=flattenObject(JSON.parse(JSON.parse(latest_quotes[e])));var r=current_quote["quoteSummary.result.0.price.regularMarketPrice.raw"],o=current_quote["quoteSummary.result.0.price.currency"],a=current_quote["quoteSummary.result.0.price.regularMarketChangePercent.raw"],l=moment.unix(current_quote["quoteSummary.result.0.price.regularMarketTime"]).format("YYYY-MM-DD"),s=moment.unix(current_quote["quoteSummary.result.0.price.regularMarketTime"]).format("h:mma"),_=(e=current_quote["quoteSummary.result.0.price.currencySymbol"],n(r/numeral(tb1.cell(i,16).data())._value)),c=l;tb1.cell(i,8).data(e+n(_)),tb1.cell(i,9).data(e+n(numeral(_)._value*numeral(tb1.cell(i,3).data())._value/currency_denominator(o))),c==moment().format("YYYY-MM-DD")?tb1.cell(i,10).data(ps(a)):tb1.cell(i,10).data("0.00%"),tb1.cell(i,12).data(ps(numeral(tb1.cell(i,9).data())._value/numeral(tb1.cell(i,6).data())._value-1)),tb1.cell(i,17).data(l+" "+s),c==moment().format("YYYY-MM-DD")?(c_today++,tb1.cell(i,11).data(e+n(numeral(tb1.cell(i,9).data())._value*numeral(tb1.cell(i,10).data())._value))):tb1.cell(i,11).data(e+"0.00")}tb1.draw(),$("#tblPortfolioM td:nth-child(11)").each(function(){numeral($(this).html())._value>=0?$(this).css("color","green").attr("id","flashGreen").addClass("active"):$(this).css("color","red").attr("id","flashRed").addClass("active")}),$("#tblPortfolioM td:nth-child(13)").each(function(){numeral($(this).html())._value>=0?$(this).css("color","green").attr("id","flashGreen").addClass("active"):$(this).css("color","red").attr("id","flashRed").addClass("active")}),$("#calcPortfolio").trigger("click")}})}function get_symbols_history_quotes(){var t=JSON.stringify(chart_symbols);$.ajax({method:"POST",url:"mult2.php",data:{url:"dummy URL",symbols_arr:t}}).done(function(t){console.log("get_symbols_history_quotes: Complete loading  stock history");try{var e=JSON.parse(t);for(symbol in e){var r=JSON.parse(JSON.parse(e[symbol]));if(r){var o=initialize_two_dim_array(r.chart.result[0].timestamp.length,2);r.chart.result[0].timestamp.map(function(t,e){o._data[e][0]=t}),r.chart.result[0].indicators.quote[0].close.map(function(t,e){o._data[e][1]=t}),console.timeEnd("get_symbols_history_quotes"),o._data=stable_prices(o._data),tickers_history_quotes[symbol]=o._data}}}catch(t){dialog("Timeout Error","\nCould not get data from webservice. \n\nPlease try again later.",BootstrapDialog.TYPE_DANGER)}})}function get_tickers_for_market(t){$.ajax({method:"POST",url:"suggest_tickers.php",data:{market:t}}).done(function(e){var r=JSON.parse(e);switch(t){case"SAMPLE":suggest_ticker=r;break;case"FTSE":suggest_ticker=r.DataList.map(function(t){return t.Eqsm+".L"});break;case"NASDAQ":suggest_ticker=r.DataList.map(function(t){return t.Eqsm});break;case"NYSE":suggest_ticker=r.DataList.map(function(t){return t.Eqsm});break;case"FRA":suggest_ticker=r.DataList.map(function(t){return t.Eqsm+".F"});break;case"EPA":suggest_ticker=r.DataList.map(function(t){return t.Eqsm+".PA"});break;case"TLV":suggest_ticker=r.DataList.map(function(t){return t.Eqsm+".TA"})}console.log("default suggested portfolio: "+suggest_ticker)})}function get_single_quote_obj(){single_quote_r&&(symbol=Object.keys(single_quote_r)[0],current_quote=flattenObject(JSON.parse(JSON.parse(single_quote_r[symbol]))),exchange=current_quote["quoteSummary.result.0.price.exchange"],single_quote.Name=current_quote["quoteSummary.result.0.price.longName"],single_quote.Symbol=current_quote["quoteSummary.result.0.price.symbol"],single_quote.LastTradeDate=moment.unix(current_quote["quoteSummary.result.0.price.regularMarketTime"]).format("YYYY-MM-DD"),single_quote.LastTradeTime=moment.unix(current_quote["quoteSummary.result.0.price.regularMarketTime"]).format("h:mma"),single_quote.LastTradePriceOnly=current_quote["quoteSummary.result.0.price.regularMarketPrice.raw"],single_quote.Change=current_quote["quoteSummary.result.0.price.regularMarketChange.fmt"],single_quote.ChangeinPercent=current_quote["quoteSummary.result.0.price.regularMarketChangePercent.fmt"],single_quote.Currency=current_quote["quoteSummary.result.0.price.currency"])}function get_Rate_Exchange(t){try{var e=JSON.stringify(t);$.ajax({method:"POST",url:"rateExchange.php",data:{url:"NA",content:e,content_tp:"NA"}}).done(function(t){var e=JSON.parse(t),r=Object.keys(e)[0];current_rx_quote=flattenObject(JSON.parse(JSON.parse(e[r])));var o=$("#f_cur option:selected").text(),a=$("#t_cur option:selected").text(),i=$("<h5 id='titleRX'><br><b>"+($("#Amount").val()||1)+"</b> "+o.substring(0,o.indexOf(":")-1)+"  to  "+a.substring(0,a.indexOf(":")-1)+"</h5>"),l=$("<h1 id='rx'>"+curSym[$("#t_cur").val()]+n(numeral($("#Amount").val()||1)._value*current_rx_quote["quoteSummary.result.0.price.regularMarketPrice.raw"])+"</h3>"),s=$("<p><br>As of: "+moment.unix(current_rx_quote["quoteSummary.result.0.price.regularMarketTime"]).format("dddd, MMM Do YYYY hh:mma")+"</p>");$("#rxDiv").text(""),$("#rxDiv").append(i).append(l).append(s),$("#rxDiv").css("visibility","visible")})}catch(t){dialog("Error",t+"\n\nCan't get rate exchange quotes from webservice.\nPlease try again later.",BootstrapDialog.TYPE_DANGER)}}function get_history_4_suggested2(t){try{begin=new Date("2013-01-01"),end=new Date;var e=JSON.stringify(t);$.ajax({method:"POST",url:"mult2.php",data:{url:"dummy URL",symbols_arr:e}}).done(function(e){console.log("get_history_4_suggested2: Complete loading  stock history");try{if(promised_s=JSON.parse(e),$.each(t,function(t,e){var r=JSON.parse(JSON.parse(promised_s[e]));if(!r.chart.error&&r.chart.result[0].timestamp){var o=initialize_two_dim_array(r.chart.result[0].timestamp.length,2);r.chart.result[0].timestamp.map(function(t,e){o._data[e][0]=t}),r.chart.result[0].indicators.quote[0].close.map(function(t,e){o._data[e][1]=t}),o._data=stable_prices(o._data),tickers_history_quotes[e]=o._data}}),portfolio_suggest._ticker_list=t,portfolio_suggest._count_tickers=t.length,p_type="suggest",resource_portfolio(1),console.log("set resource portfolio to 1 from suggest"),portfolio&&(portfolio_main=portfolio),portfolio=portfolio_suggest,promised=promised_s,create_portfolio_obj2(),$("#market").addClass("btn btn-success"),$("#market").text("Suggest Portfolio"),$("#market i").remove(),validate_portfolio(),portfolio_suggest._count_tickers>2){build_portfolio(0),portfolio_suggest=portfolio,portfolio_main&&(portfolio=portfolio_main),dialog("Suggested portfolio","Recommended portfolio is ready",BootstrapDialog.TYPE_INFO),resource_portfolio(0);var r=[];(r=initialize_two_dim_array(portfolio_suggest._count_tickers+2,5))._data[0][0]="Company Name",r._data[0][1]="Symbol",r._data[0][2]="Growth p/m",r._data[0][3]="Risk",r._data[0][4]="Efficiency",$.each(portfolio_suggest.info,function(t,e){global[e.Symbol]?r._data[t+1][0]=global[e.Symbol]["quoteSummary.result.0.price.shortName"]:r._data[t+1][0]="DON'T KNOW",r._data[t+1][1]=e.Symbol,r._data[t+1][2]=p(e.growth_mean),r._data[t+1][3]=p(e.growth_std),r._data[t+1][4]=n(e.s_ratio)});var o=portfolio_suggest._count_tickers;r._data[o+1][0]="Portfolio",r._data[o+1][1]="Portfolio",r._data[o+1][2]=p(portfolio_suggest._mean),r._data[o+1][3]=p(portfolio_suggest._std_dev),r._data[o+1][4]=n(portfolio_suggest._s_Ratio),inject_table(r._data,"#suggest_table"),$("#suggest_table tr:last").css({backgroundColor:"yellow",fontWeight:"bolder"})}else dialog("Ooops","\n Could not find enough tickers. No charge to your credit card",BootstrapDialog.TYPE_DANGER)}catch(t){console.log("error in sugg.js get_history_4_suggested2"),dialog("Error","\n Can not get history at this stage. No charge to your credit card",BootstrapDialog.TYPE_DANGER),portfolio_main&&(portfolio=portfolio_main),resource_portfolio(0)}})}catch(t){console.log("error in sugg.js get_history_4_suggested2 "),portfolio_main&&(portfolio=portfolio_main),dialog("Oops...","\n\nCan't get historic quotes from webservice.\nPlease try again later\nNo charge to your credit card",BootstrapDialog.TYPE_DANGER),resource_portfolio(0)}resource_portfolio(0)}function get_history_4_suggested(t){try{begin=new Date(begin),end=new Date;var e=JSON.stringify(t),r="http://chart.finance.yahoo.com/table.csv?&a="+begin.getUTCMonth()+"&b="+begin.getUTCDate()+"&c="+begin.getUTCFullYear()+"&d="+end.getUTCMonth()+"&e="+end.getUTCDate()+"&f="+end.getUTCFullYear()+"&s=";console.log("get_history_4_suggested - calling ajax get history quotes"),$.ajax({method:"POST",url:"rxHist.php",data:{url:r,content:"stock_history_prices",symbols_arr:e}}).done(function(e){console.log("get_history_4_suggested: Complete loading table stock history");try{promised_s=JSON.parse(e),portfolio_suggest={},console.log("get_history_4_suggested - got response with size: "+promised_s.length),portfolio_suggest._from_date=begin,portfolio_suggest._to_date=end,portfolio_suggest._ticker_list=t,portfolio_suggest._count_tickers=t.length,p_type="suggest",resource_portfolio(1),console.log("set resource portfolio to 1 from suggest"),portfolio=portfolio_suggest,promised=promised_s,create_portfolio_obj2(),$("#market").text("Found!!!"),$("#market i").remove(),validate_portfolio(),portfolio_suggest._count_tickers>2&&(build_portfolio(0),portfolio_suggest=portfolio,portfolio={},dialog("Suggested portfolio","Recommended portfolio is ready",BootstrapDialog.TYPE_INFO),resource_portfolio(0))}catch(t){console.log("error in sugg.js get_history_4_suggested line 100"),dialog("Error",t,BootstrapDialog.TYPE_DANGER),resource_portfolio(0)}})}catch(t){console.log("error in sugg.js get_history_4_suggested line 109 "),dialog("Oops...","\n\nCan't get historic quotes from webservice.\nPlease try again later",BootstrapDialog.TYPE_DANGER),resource_portfolio(0)}resource_portfolio(0)}function get_rateExHistory(t){try{var e,r,o={},a=[];e=$(t).not(Object.keys(currency_history_obj)).get();var i=JSON.stringify(e);e.length&&(console.log("get_rateExHisttory - Calling ajax get rate exchange history"),$.ajax({method:"POST",url:"rxHist.php",data:{url:"insidePHP",content:"rate_exchange_history",symbols_arr:i}}).done(function(t){try{var e=JSON.parse(t);for(x in e)o=JSON.parse(JSON.parse(e[x])),r=o.chart.result[0].timestamp.length,a=initialize_two_dim_array(r,2),o.chart.result[0].timestamp.map(function(t,e){a._data[e][0]=moment.unix(t).format("YYYY-MM-DD")}),o.chart.result[0].indicators.quote[0].close.map(function(t,e){a._data[e][1]=t}),"USD"!==x&&(a._data=stable_prices(a._data)),currency_history_obj[x]=a._data;$("#buildPortfolio i").remove(),$("#buildPortfolio").addClass("btn btn-success"),$("#buildPortfolio").removeAttr("disabled"),$("#buildPortfolio").text("Analyse Portfolio"),console.log("get_rateExHisttory: Complete loading rate exchange history")}catch(t){console.log("error in sugg.js get_rateExHistory line 152"),dialog("Error","\n\nCan't get historic Exchange-Rate from webservice.\nPlease try again later",BootstrapDialog.TYPE_DANGER)}}))}catch(t){console.log("error in sugg.js get_rateExHistory line 160"),dialog("Oops...",t,BootstrapDialog.TYPE_DANGER)}}function get_pairRxHistory(t){try{var e,r=JSON.stringify(t),o={},a=[];console.log("get_pairRxHistory - calling ajax get history quotes"),$.ajax({method:"POST",url:"rxHist.php",data:{url:"insidePHP",content:"rate_exchange_history",symbols_arr:r}}).done(function(t){console.log("get_pairRxHistory: Complete loading rate exchange history");try{var r=JSON.parse(t);for(var i in r){o=JSON.parse(JSON.parse(r[i])),e=o.chart.result[0].timestamp.length,a=initialize_two_dim_array(e,6),o.chart.result[0].timestamp.map(function(t,e){a._data[e][0]=moment.unix(t).format("YYYY-MM-DD")}),o.chart.result[0].indicators.quote[0].close.map(function(t,e){a._data[e][1]=t}),o.chart.result[0].indicators.quote[0].high.map(function(t,e){a._data[e][2]=t}),o.chart.result[0].indicators.quote[0].low.map(function(t,e){a._data[e][3]=t}),o.chart.result[0].indicators.quote[0].volume.map(function(t,e){a._data[e][4]=t}),o.chart.result[0].indicators.quote[0].open.map(function(t,e){a._data[e][5]=t}),currency_history_obj[i]=a._data,two_dim_arr=[],two_dim_arr=a._data,tb_rx&&(tb_rx.destroy(),$("#rxTB").empty()),create_table("_rate_exchange"),$("#rxChart").empty(),rate_exchange_chart(i.substring(0,3)+" "+i.substring(3,6),"rxChart")}}catch(t){console.log("error in sugg.js get_pairRxHistory"),dialog("Error","\n\nCan't get historic Exchange-Rate from webservice.\nPlease try again later",BootstrapDialog.TYPE_DANGER)}})}catch(t){console.log("error in get_pairRxHistory"),dialog("Oops...",t,BootstrapDialog.TYPE_DANGER)}}function ajax_current_quotes5(t,e){var r='["'+t.join('","')+'"]';console.log("ajax_current_quotes5: - Calling ajax get currency pair quotes"),$.ajax({method:"POST",url:"quotes5.php",data:{url:"NA",content:r,content_tp:e}}).done(function(t){for(x in console.log("ajax_current_quotes5: - Complete loading currency pair quotes"),single_quote_rx=JSON.parse(t),single_quote_rx)exchange_rate[x]=flattenObject(JSON.parse(JSON.parse(single_quote_rx[x])));for(var e=0;e<tbRows;e++)tb1.cell(e,13).data(CurrFull[base_currency].symbol+n(numeral(tb1.cell(e,11).data())._value*exchange_rate[tb1.cell(e,7).data()+base_currency+"=X"]["quoteSummary.result.0.price.regularMarketPrice.raw"])).draw(),tb1.cell(e,14).data(CurrFull[base_currency].symbol+n(numeral(tb1.cell(e,9).data())._value*exchange_rate[tb1.cell(e,7).data()+base_currency+"=X"]["quoteSummary.result.0.price.regularMarketPrice.raw"])).draw();var r=tb1.column(14).data().reduce(function(t,e){return numeral(t)._value+numeral(e)._value},0);for(e=0;e<tbRows;e++)tb1.cell(e,15).data(p(numeral(tb1.cell(e,14).data())._value/r)).draw();handle_footer()})}function csv2arr(t){try{var e=[],r=[];lines=t.split(/\r\n|\r|\n/),columns=lines[0].split(",");for(var o=1;o<=lines.length-1;o++){var a=lines[o].split(","),i=[0,6];for(var n in i)e.push(a[i[n]]);r.push(e),e=[]}return r.reverse().slice(1)}catch(t){return console.log("error at parse-csv2 line 41"),t}}function create_ticker_array_from_history(t){for(slice_ticker_arr=[],i=0;i<tickers_history_quotes.quote.length;i++)tickers_history_quotes.quote[i].Symbol===t&&slice_ticker_arr.push(tickers_history_quotes.quote);return slice_ticker_arr}function create_vector_arr(t){var e,r;for(vector=[],r=t.length,e=0;e<r;e+=1)vector.push(parseFloat(t[e][1]));return vector}function n(t){return numeral(t).format("0,0.00")}function ns(t){return numeral(t).format("+0,0.00")}function p(t){return numeral(t).format("0,0.00%")}function ps(t){return numeral(t).format("+0,0.00%")}function factor10(t,e){return Math.pow(10,Math.round(Math.log10(t/e)))}function create_chart_data(t){var e;chart_arr=initialize_two_dim_array(t.length,2),e=t.length;for(var r=0;r<e;r+=1)chart_arr._data[r][0]=moment(t[r][0]).valueOf(),chart_arr._data[r][1]=round_to(t[r][1],1)}function create_growth_vector_arr(t){var e;e=[];for(var r=1;r<t.length;r++)numeral(e.push(Math.log(t[r]/t[r-1]))).format("0.0000%");return e}function initialize_two_dim_array(t,e){return math.zeros(t,e)}function create_growth_combine_arr(){for(var t=0;t<portfolio._count_tickers;t++)for(var e=0;e<portfolio.info[0].range_growth_arr.length;e++)two_dim_arr._data[t][e]=portfolio.info[t].range_growth_arr[e]}function create_covariance_arr(){for(var t=0;t<portfolio._count_tickers;t++)for(var e=0;e<portfolio._count_tickers;e++)two_dim_arr._data[t][e]=round_to(covariance(portfolio._returns._data[t],portfolio._returns._data[e]),4)}function create_correlation_arr(){for(var t=0;t<portfolio._count_tickers;t++)for(var e=0;e<portfolio._count_tickers;e++)two_dim_arr._data[t][e]=numeral(correlation(portfolio._returns._data[t],portfolio._returns._data[e])).format("0.0000")}function portfolio_mean_arr(){for(var t=[],e=0;e<portfolio._returns._data.length;e++)t.push(vector_mean(portfolio._returns._data[e]));return t}function portfolio_stdev_arr(){for(var t=[],e=0;e<portfolio._returns._data.length;e++)t.push(vector_stdev(portfolio._returns._data[e]));return t}function portfolio_mean(t,e){return math.multiply(t,e)}function portfolio_stdev(t,e){return math.sqrt(math.multiply(math.multiply(t,e),e))}function vector_growth(t){return(t[t.length-1]-t[0])/t[0]}function vector_mean(t){return jStat.mean(t)}function vector_stdev(t){return jStat.stdev(t)}function total_ratio(t){return vector_growth(t)/vector_stdev(t)}function sharpe_ratio(t){return(vector_mean(t)-.25)/vector_stdev(t)}function vector_norm_stdev(t){return vector_mean(t)-1.654*vector_stdev(t)}function covariance(t,e){return jStat.covariance(t,e)}function correlation(t,e){return jStat.corrcoeff(t,e)}function drift(t){return vector_mean(t)-vector_stdev(t)/2}function monte_carlo(t,e,r){return t*Math.exp(e+r*jStat.normal.inv(Math.random(),0,std_dev))}function is_min_date(t,e){return t<=e}function is_max_date(t,e){return t>=e}function max_price_in_date_range(t,e){if(Date.parse(t[0].Date)>e)return console.log("could not find min date range "+t[0].Date+" > "+e),!1;for(var r=t.length-1;r>=0;r--)if(is_min_date(Date.parse(t[r].Date),e))return console.log("found: "+t[r].Adj_Close+" "+t[r].Date+" "+t[r].Symbol),t[r].Adj_Close;return console.log("could not find date in range"),!1}function min_price_in_date_range(t,e){if(Date.parse(t[t.length-1].Date)<e)return console.log("could not find  max date range "+t[t.length-1].Date+" < "+e),!1;for(var r=0;r<=t.length-1;r++)if(is_max_date(Date.parse(t[r].Date),e))return console.log("found: "+t[r].Adj_Close+" "+t[r].Date+" "+t[r].Symbol),t[r].Adj_Close;return console.log("could not find date in range"),!1}function create_date_range_arr(t,e){var r=new moment(t),o=new moment(e),a=[];do{a.push(moment(r).add(1,"months").format("YYYY-MM-DD")),r=moment(r).add(1,"months")}while(moment(r).add(1,"months")<o);return a.push(o.format("YYYY-MM-DD")),a}function create_ticker_arr_from_history(t,e){var r=[];for(i=0;i<t.length;i++)t[i].Symbol===e&&r.push(t[i]);return r}function create_ticker_list_arr(t){var e=[t[0].Symbol]||[];if(e.length)for(i=1;i<t.length;i++)t[i].Symbol!==t[i-1].Symbol&&e.push(t[i].Symbol);else alert("create_ticker_list_arr - no input array found");return e}function create_month_arr(t,e){for(var r=[];e>=t;)r.push(t.format("YYYY-MM")),t.add(1,"month");return r}function create_1d_array_of_growth(){var t,e;t=dates(new Date(ticker_months_arr[0])).lastDayOfMonth,e=dates(new Date(ticker_months_arr[ticker_months_arr.length-1])).firstDayOfMonth,alert("Min Date "+t+" Max Date Range: "+e)}function dates(t){return{now:new Date,firstDayOfMonth:new Date(t.getFullYear(),t.getMonth(),1),lastDayOfMonth:new Date(t.getFullYear(),t.getMonth()+1,0),firstDayNextMonth:new Date(t.getFullYear(),t.getMonth()+1,1),lastDayNextMonth:new Date(t.getFullYear(),t.getMonth()+2,0),firstDayOfYear:new Date(t.getFullYear(),0,1),lastDayOfYear:new Date(t.getFullYear()+1,0,0),firstDayNextYear:new Date(t.getFullYear()+1,0,1),lastDayNextYear:new Date(t.getFullYear()+2,0,0),dayOfDate:t.getUTCDate(),monthOfDate:t.getUTCMonth(),yearOfDate:t.getUTCFullYear()}}function round(t,e){return Number(Math.round(t+"e"+e)+"e-"+e)}function monthDiff(t,e){var r;return r=12*(e.getFullYear()-t.getFullYear()),r-=t.getMonth()+1,(r+=e.getMonth())<=0?0:r}function diff_months(t,e){var r=(t.getTime()-e.getTime())/1e3;return(r/=2419200)<=0?0:round_to(r,2)}function round_to(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function calc_return(){Math.pow(optim_obj._target_return+1,diff_months(end,begin))}function generate_uniqe_numbers(t){var e=suggest_ticker.length-1;for(unique_random_numbers=[],3>t&&(t=3);unique_random_numbers.length<t;){var r=Math.round(Math.random()*(e-1)+1);-1==unique_random_numbers.indexOf(r)&&unique_random_numbers.push(r)}return unique_random_numbers}function validate_portfolio(){var t=max_size_of_range_growth_arr(),e=[];for(i=portfolio._count_tickers-1;i>=0;i--)if(portfolio.info[i].range_growth_arr.length<t)alert("Ticker: "+portfolio._ticker_list[i]+" found : "+portfolio.info[i].range_growth_arr.length+" less than: "+t+" reading. Ticker will be removed from portfolio."),e.push(portfolio._ticker_list[i]);else{date_range_arr=[],date_range_arr=portfolio.info[i].range_data.map(function(t){return t[0]}),portfolio._date_ragne_arr=date_range_arr;var r=portfolio.info[i].range_growth_arr.map(function(t){return isNaN(t)}).indexOf(!0);r>-1&&(alert("Ticker: "+portfolio._ticker_list[i]+" element #["+r+"] is undefined. Ticker will be removed from portfolio."),e.push(portfolio._ticker_list[i]))}e.length>0&&remove_ticker_from_portfolio2(e)}function build_portfolio(t){try{if(two_dim_arr=initialize_two_dim_array(portfolio._count_tickers,portfolio.info[0].range_growth_arr.length),create_growth_combine_arr(),portfolio._returns=two_dim_arr,two_dim_arr=initialize_two_dim_array(portfolio._count_tickers,portfolio._count_tickers),create_correlation_arr(),portfolio._correlation=two_dim_arr,two_dim_arr=initialize_two_dim_array(portfolio._count_tickers,portfolio._count_tickers),create_covariance_arr(),portfolio._covariance=two_dim_arr,portfolio._mean_arr=portfolio_mean_arr(),portfolio._stdev_arr=portfolio_stdev_arr(),0===t)portfolio._weight_option="equal",portfolio._wgt_arr=math.divide(math.ones(portfolio._count_tickers),portfolio._count_tickers);else{if(!optim_obj)return void alert("can't build portfoio - something is wrong.");portfolio._weight_option="optimized",portfolio._wgt_arr=math.matrix(optim_obj._weight)}if(portfolio._mean_arr.length!==portfolio._wgt_arr._data.length)return void alert("Can't optimize portfolio - not the same size of portfolio");portfolio._mean=portfolio_mean(portfolio._mean_arr,portfolio._wgt_arr._data),portfolio._std_dev=portfolio_stdev(portfolio._covariance._data,portfolio._wgt_arr._data),portfolio._s_Ratio=(portfolio._mean-.001)/portfolio._std_dev}catch(t){console.log("error in build_portfolio"),$("#buildPortfolio").addClass("btn btn-danger"),$("#buildPortfolio").text("No Portfolio"),$("#buildPortfolio").attr("disabled","disabled"),dialog("Error",t+"\n\nCan't build portfolio at this stage",BootstrapDialog.TYPE_DANGER)}}function benchmark_portfolio(){console.log("Creating benchmark portfolio"),portfolio_history=portfolio,portfolio={},json_quotes=[],portfolio._count_tickers=portfolio_history._count_tickers,portfolio._ticker_list=portfolio_history._ticker_list,get_quotes(portfolio._ticker_list),portfolio._ticker_list=portfolio.info.map(function(t){return t.Symbol}),portfolio._count_tickers=portfolio._ticker_list.length,weight_option=1,growth_readings=max_size_of_range_growth_arr(),validate_portfolio(),portfolio._count_tickers>2?build_portfolio(weight_option):alert("can't build portfolio with less than 3 items")}function max_size_of_range_growth_arr(){return math.max(portfolio.info.map(function(t){return t.range_growth_arr.length}))}function max_size_of_price_arr(){return math.max(portfolio.info.map(function(t){return t.daily_prices.length}))}function index_of(t){return portfolio._ticker_list.indexOf(t)}function remove_ticker_from_portfolio(t){var e=portfolio._ticker_list.reverse().indexOf(t);if(-1===e)return t;portfolio._ticker_list.splice(e,1),portfolio._count_tickers=portfolio._ticker_list.length,portfolio._ticker_list.reverse()}function remove_ticker_from_portfolio2(t){portfolio._ticker_list=$(portfolio._ticker_list).not(t),portfolio._count_tickers=portfolio._ticker_list.length}function monte_carlo_simulation(t,e,r){var o,a,i;o=t,a=t,i=t;for(var n=0;n<monte_carlo_sim;n++)(o=monte_carlo(o,e,r))>a&&(a=o),o<i&&(i=o);return monte_carlo_obj.min=i,monte_carlo_obj.max=a,monte_carlo_obj}function create_indicators_array(){var t,e=portfolio._count_tickers,r=indicator_arr.length,o=[];o=initialize_two_dim_array(e,r+1);for(var a=0;a<e;a++)for(var i=0;i<r;i++)o._data[a][0]=portfolio.info[a].Symbol,t=indicator_arr[i],o._data[a][i+1]=read_property_value(portfolio.info[a].current_quote,decode(t),a)||read_property_value(portfolio.info[a],decode(t),a)||read_property_value(indicators,t,a)||"NA";return o}function read_property_value(t,e,r){return t[e]?parse_indicator(e,t[e],r):0}function decode(t){var e=t;return $.each(indicators,function(r,o){o==t&&(e=r)}),e}function parse_indicator(t,e,r){switch(t){case"MarketCapitalization":if(e.search("B")>-1)return 1e3*e.substring(0,e.search("B"));if(e.search("M")>-1)return 1*e.substring(0,e.search("M"));if(t.search("NA")>-1)return 0;break;case"LastTradePriceOnly":case"ChangeinPercent":case"Change":case"FiftydayMovingAverage":case"PercentChangeFromYearLow":case"Last_Change":return ps(e);case"Currency":return e.toUpperCase();case"Holdings":return n(symbols.Holdings(r));case"Start_Date":return symbols.Start_Date(r);case"Start_Price":return n(symbols.Start_Price(r));case"Start_Settlement":return n(symbols.Start_Settlement(r));case"Total":return n(symbols.Total(r));case"Change_Since_Inception":return n(symbols.Change_Since_Inception(r));case"Total_Base_Currency":return n(symbols.Total_Base_Currency(r));case"Pctg_Portfolio":return n(symbols.Pctg_Portfolio);case"_count_tickers":case"_from_date":case"_to_date":case"_weight_option":return e;case"_mean":case"_std_dev":case"growth_mean":case"growth_std":case"t_tatio":return ps(e);case"s_ratio":case"prices_mean":return n(e);default:return e}}function sort_portfolio_indicator_by(t){return portfolio_indicator._data.sort(function(e,r){return e[t]-r[t]}).reverse()}function create_sharpe_ratio_array(){s_r_arr=initialize_two_dim_array(portfolio.info.length,3);for(var t=0;t<portfolio.info.length;t++)s_r_arr._data[t][0]=portfolio.info[t].Symbol,s_r_arr._data[t][1]=portfolio.info[t].s_ratio,s_r_arr._data[t][2]=portfolio.info[t].t_ratio;s_r_arr._data=s_r_arr._data.sort(function(t,e){return t[1]-e[1]}).reverse()}function validate_current_quotes_obj(t){var e=[],r=t.map(function(t){return t.Name});$.each(r,function(t,r){null!=r&&e.push(current_quotes_obj.query.results.quote[t])}),current_quotes_obj.query.results.quote=e,current_quotes_obj.query.count=e.length}function find_closest_date_unix(t){if(moment.unix(t[0]).valueOf()>=moment(settled_date).valueOf())return t}function find_closest_date(t){if(moment(t[0]).valueOf()>=moment(settled_date).valueOf())return t}function find_closest_month(t){if(moment(t[0]).valueOf()>=moment(search_month).valueOf())return t}function find_closest_rate(t){if(t>=settled_date)return t}function rateExchange(t){if(t[0]>=settled_date)return t}function validate_add2portfolio(){var t=!1;return settled_date?moment(settled_date).valueOf()<moment.unix(tickers_history_quotes[selected_symbol][0][0]).valueOf()||moment(settled_date).valueOf()>moment.unix(tickers_history_quotes[selected_symbol][tickers_history_quotes[selected_symbol].length-1][0]).valueOf()?($(".validate").text("Date: "+settled_date+" out of range :"+moment.unix(tickers_history_quotes[selected_symbol][0][0]).format("YYYY-MM-DD")+" and "+moment.unix(tickers_history_quotes[selected_symbol][tickers_history_quotes[selected_symbol].length-1][0]).format("YYYY-MM-DD")),t):settled_amt||settled_holding?0===numeral(settled_amt)._value?($(".validate").text("Please enter settled amount grater than zero"),t):numeral(settled_amt)._value<0?($(".validate").text("Please enter settled amount grater than zero"),t):0===numeral(settled_holding)._value?($(".validate").text("Please enter number of holdings grater than zero"),t):numeral(settled_holding)._value<0?($(".validate").text("Please enter number of holdings grater than zero"),t):t=!0:($(".validate").text("Enter Either/Or Amount/Holdings:"),t):($(".validate").text("Please enter start date:"),t)}function validate_before_purchase(t){var e=!1;return t.find(".noPortfolio").length>0?e=!0:portfolio_ready?!daily_track._data||daily_track._data.length<200?(message_h="No portfolio data",message_b="Could not generate consolidated porttfolio (daily tracking). \n\nPlease try again later or report error to admin.",e):tbRows<3?(message_h="Not enough stocks",message_b="You need at least 3 stocks to build a portfolio. \n\nPlease try again later or report error to admin.",e):portfolio.info.length<3?(message_h="Not enough stocks",message_b="System could not generate portfolio.  \n\nPlease try again later or report error to admin.",e):combine_price._data.length<tbRows-3?(message_h="Not enough stocks",message_b="Not enough stocks to generate stable portfolio. \n\nPlease try again later or report error to admin.",e):e=!0:(message_h="Portfolio not ready",message_b="Portfolio is not ready. \n\nPlease click on Analyse Portfolio or try again later.",e)}function validate_license(t){var e=!1;return t.find(".glyphicon-shopping-cart").length>0?e:portfolio_ready?t.children().attr("data-max_tickers")<tbRows&&!$("#RadioSample").prop("checked")&&-1==purchase.indexOf("ALL")?(dialog("License Exceed","License for feature: "+t.children().data().name+" is limited to :"+t.children().data().max_tickers+".\n\n Number of current portfolio symbols: "+tbRows+".\n\n Please reduce number of symbols."),e):e=!0:(dialog("Portfolio Not Ready","Please click on Analys Portfolio.",BootstrapDialog.TYPE_INFO),e)}function update_db_portfolio(t,e,r){sql_operation=e,$.ajax({method:"POST",url:"save_portfolio2DB.php",data:{portfolioM:t,count_rows:tbRows,action:e,portfolio_type:r}}).done(function(t){tb=t,"select"===sql_operation&&(tb1.destroy(),$("#tblPortfolioM tbody").empty(),$("#tblPortfolioM tbody").html(tb),tb1=$("#tblPortfolioM").DataTable({paging:!1,info:!1,searching:!1,responsive:!0,scrollX:!0,scrollY:"600px",scrollCollapse:!0}),tbRows=tb1.rows().data().length),refresh_table_data()})}function get_purchase_feature(t,e,r){$.ajax({method:"POST",url:"save_portfolio2DB.php",data:{portfolioM:t,count_rows:tbRows,action:e,portfolio_type:r}}).done(function(t){console.log("purchased features: "+t),purchase=JSON.parse(t),purchase.length>0&&(purchase.indexOf("ALL")>-1?$(".glyphicon-shopping-cart ").each(function(){$(this).removeClass("glyphicon-shopping-cart").addClass("glyphicon-ok").attr("data-max_tickers",purchase[purchase.length-1]).parents(".base-currency").find(".selectpicker").removeAttr("disabled"),$(".selectpicker").selectpicker("refresh")}):$.each(purchase,function(t,e){$(".glyphicon-shopping-cart ").each(function(){$(this).data().name==e&&$(this).removeClass("glyphicon-shopping-cart").addClass("glyphicon-ok").attr("data-max_tickers",purchase[purchase.length-1]).parents(".base-currency").find(".selectpicker").removeAttr("disabled"),$(".selectpicker").selectpicker("refresh")})}))})}function get_purchase_market(t,e,r){$.ajax({method:"POST",url:"save_portfolio2DB.php",data:{portfolioM:t,count_rows:tbRows,action:e,portfolio_type:r}}).done(function(t){console.log("purchased suggest market portfolio: "+t);var e=JSON.parse(t);e.length>0&&$.each(e,function(t,e){purchase_market.push(e.substring(7))})})}function get_historic_purchase(t,e,r){$.ajax({method:"POST",url:"save_portfolio2DB.php",data:{portfolioM:t,count_rows:tbRows,action:e,portfolio_type:r}}).done(function(t){var e=JSON.parse(t);$("#purchase_historyTb").DataTable({responsive:!0,scrollX:!0,scrollY:"600px",scrollCollapse:!0,data:e,columns:[{title:"User"},{title:"Purchase Date"},{title:"Portfolio"},{title:"Feature Purchased"},{title:"Purchase Amount"},{title:"Payment ID"},{title:"Payment Type"},{title:"Payment Status"},{title:"Card Type"},{title:"Count Tickers"},{title:"Portfolio Tickers"}]})})}function get_table_column(t,e){return $(t.column(e).data()).splice(0,t.column(e).data().length)}function refresh_table_data(){ticker_list_arr=get_table_column(tb1,1),ticker_list_arr.length>0&&get_history2()}function combine_prices(){var t,e=[];for(r=0;r<portfolio._count_tickers;r++)for(o=0;o<portfolio.info[r].daily_prices.length;o++)e.push(portfolio.info[r].daily_prices[o][0]);for($.unique(e).sort(),combine_price=initialize_two_dim_array(portfolio._count_tickers+1,e.length),combine_return=initialize_two_dim_array(portfolio._count_tickers+1,e.length),i=0;i<e.length;i++)combine_price._data[0][i]=e[i],combine_return._data[0][i]=e[i];for(var r=0;r<portfolio._count_tickers;r++){for(var o=0;o<portfolio.info[r].daily_prices.length;o++)if(t=e.indexOf(portfolio.info[r].daily_prices[o][0]),0==o&&t>0){settled_date=portfolio.info[r].daily_prices[o][0];var a=portfolio.info[r].daily_prices.find(find_closest_date);combine_price._data[r+1][0]=a[1]}else t>-1&&(combine_price._data[r+1][t]=portfolio.info[r].daily_prices[o][1]);for(var n=0;n<e.length;n++)0==combine_price._data[r+1][n]&&(combine_price._data[r+1][n]=combine_price._data[r+1][n-1])}for(r=0;r<portfolio._count_tickers;r++)for(n=1;n<e.length;n++)combine_return._data[r+1][n]=numeral(Math.log(combine_price._data[r+1][n]/combine_price._data[r+1][n-1])).format("0.0000%");portfolio._daily_prices=combine_price._data,portfolio._daily_returns=combine_return._data}function create_weight_array(){var t,e,r=[];t=get_table_column(tb1,15),e=math.multiply(math.ones(portfolio._count_tickers)._data,1/portfolio._count_tickers),r=initialize_two_dim_array(portfolio._count_tickers,5);for(var o=0;o<portfolio._count_tickers;o++)for(var a=0;a<5;a++)r._data[o][0]=portfolio.info[o].Symbol,r._data[o][1]=p(t[o]),r._data[o][2]=p(e[o]),r._data[o][3]=0,r._data[o][4]=0;return r}function create_monte_carlo_array(t){var e,r,o,a=[],i={},l=[];a=initialize_two_dim_array(portfolio._count_tickers,10);for(var s=0;s<portfolio._count_tickers;s++){e=vector_mean(l=portfolio.info[s].growth_arr.slice(0,portfolio.info[s].daily_growth_count-slider_d.getValue())),r=vector_stdev(l),o=e-Math.pow(r,2)/2,monte_carlo_sim=slider_d.getValue(),i=monte_carlo_simulation(t[s][1],o,r);for(var _=0;_<10;_++)a._data[s][0]=portfolio.info[s].Symbol,a._data[s][1]=slider_d.getValue(),a._data[s][2]=slider_s.getValue(),a._data[s][3]=n(t[s][1]),a._data[s][4]=moment(t[s][0]).format("YYYY-MM-DD"),a._data[s][5]=n(i.max),a._data[s][6]=n(i.min),a._data[s][7]=n(portfolio.info[s].daily_prices[portfolio.info[s].daily_prices.length-1][1]),a._data[s][8]=moment(portfolio.info[s].daily_prices[portfolio.info[s].daily_prices.length-1][0]).format("YYYY-MM-DD"),i.min>portfolio.info[s].daily_prices[portfolio.info[s].daily_prices.length-1][1]?a._data[s][9]="YES":a._data[s][9]="NO"}return a}function create_prediction_arr(t){var e,r,o,a=[],i={},l=[];a=initialize_two_dim_array(portfolio._count_tickers,10);for(var s=0;s<portfolio._count_tickers;s++){e=vector_mean(l=portfolio.info[s].growth_arr.slice(0,portfolio.info[s].daily_growth_count-slider_d.getValue())),r=vector_stdev(l),o=e-Math.pow(r,2)/2,monte_carlo_sim=slider_d.getValue(),i=monte_carlo_simulation(price_arr[s][1],o,r);for(var _=0;_<10;_++)a._data[s][0]=portfolio.info[s].Symbol,a._data[s][1]=slider_d.getValue(),a._data[s][2]=slider_s.getValue(),a._data[s][3]=n(price_arr[s][1]),a._data[s][4]=moment(price_arr[s][0]).format("YYYY-MM-DD"),a._data[s][5]=n(i.max),a._data[s][6]=n(i.min),a._data[s][7]=n(portfolio.info[s].daily_prices[portfolio.info[s].daily_prices.length-1][1]),a._data[s][8]=moment(portfolio.info[s].daily_prices[portfolio.info[s].daily_prices.length-1][0]).format("YYYY-MM-DD"),i.min>portfolio.info[s].daily_prices[portfolio.info[s].daily_prices.length-1][1]?a._data[s][9]="YES":a._data[s][9]="NO"}return a}function resource_portfolio(t){p_semaphor=t}function daily_stats(){try{var t,e,r,o=[],a=[],i=(portfolio._wgt_arr._data,[]),l=[];settled_date=combine_price._data[0][0],t=(o=combine_price._data[0]).find(find_closest_rate),e=o.indexOf(t),o=o.slice(e),r=get_table_column(tb1,3),get_table_column(tb1,16),daily_track=initialize_two_dim_array(o.length,4),combine_price._data.map(function(t,r){r>0&&a.push(t[e])}),portfolio.info.map(function(t,e){i.push(t.current_quote["quoteSummary.result.0.price.currency"].toUpperCase())}),a.map(function(t,e){l.push(numeral(numeral(a[e])._value*numeral(r[e])._value/currency_history_obj[i[e]].find(rateExchange)[1]/currency_denominator(i[e]))._value)}),math.divide(l,math.sum(l)),daily_track._data[0][0]=o[0],daily_track._data[0][1]="$"+n(math.sum(l)),daily_track._data[0][2]=0,daily_track._data[0][3]=0;for(var s=1;s<o.length;s++)a=[],l=[],settled_date=o[s],combine_price._data.map(function(t,e){e>0&&a.push(t[s])}),a.map(function(t,e){var o=currency_history_obj[i[e]][currency_history_obj[i[e]].length-1][0],n=currency_history_obj[i[e]][currency_history_obj[i[e]].length-1][1];settled_date<o?l.push(numeral(numeral(a[e])._value*numeral(r[e])._value/currency_history_obj[i[e]].find(rateExchange)[1]/currency_denominator(i[e]))._value):l.push(numeral(numeral(a[e])._value*numeral(r[e])._value/n/currency_denominator(i[e]))._value)}),math.divide(l,math.sum(l)),daily_track._data[s][0]=o[s],daily_track._data[s][1]="$"+n(math.sum(l)),daily_track._data[s][2]=n(numeral(daily_track._data[s][1])._value-numeral(daily_track._data[s-1][1])._value),daily_track._data[s][3]=p(numeral(daily_track._data[s][1])._value/numeral(daily_track._data[s-1][1])._value-1);portfolio.daily_tracking=daily_track._data;s=initialize_two_dim_array(daily_track._data.length,2);$.each(daily_track._data,function(t,e){s._data[t][0]=numeral(moment(e[0]).format("X"))._value,s._data[t][1]=numeral(e[1])._value}),tickers_history_quotes.portfolio=s._data}catch(t){console.log("error in daily stats"),dialog("Error",t+"\n\nCan't build portfolio at this stage",BootstrapDialog.TYPE_DANGER),$("#buildPortfolio").addClass("btn btn-danger"),$("#buildPortfolio").text("No Portfolio"),$("#buildPortfolio").attr("disabled","disabled")}}function generate_accumulated_growth_array(t){var e=[];(e=initialize_two_dim_array(t.daily_prices.length,2))._data[0][0]=t.daily_prices[0][0];for(var r=1;r<e._data.length;r++)e._data[r][0]=t.daily_prices[r][0],e._data[r][1]=(1+e._data[r-1][1])*(1+t.growth_arr[r-1])-1;return e}function stable_prices(t){for(var e=t.length,r=(t[0][1],1);r<e;r++){var o=t[r-1][1],a=factor10(t[r][1],o);o&&(t[r][1]||(t[r][1]=o),1!==a&&0!==a&&(t[r][1]/=a))}return t}function flattenObject(t){var e={};for(var r in t)if(t.hasOwnProperty(r))if("object"==typeof t[r]){var o=flattenObject(t[r]);for(var a in o)o.hasOwnProperty(a)&&(e[r+"."+a]=o[a])}else e[r]=t[r];return e}function addNWdays(t,e){for(var r=0,o=new Date(t);e>=0;)o.setTime(t.getTime()+864e5*r),isBusinessDay(o)&&--e,++r;return o}function isBusinessDay(t){var e=t.getDay();if(0===e||6===e)return!1;holidays=["12/31+5","1/1","1/2+1","1-3/1","2-3/1","5~1/1","7/3+5","7/4","7/5+1","9-1/1","10-2/1","11/10+5","11/11","11/12+1","11-4/4","12/24+5","12/25","12/26+1"];var r=t.getDate(),o=t.getMonth()+1,a=o+"/"+r;if(holidays.indexOf(a)>-1)return!1;var i=a+"+"+e;if(holidays.indexOf(i)>-1)return!1;var n=o+"-"+(Math.floor((r-1)/7)+1)+"/"+e;if(holidays.indexOf(n)>-1)return!1;var l=new Date(t);l.setMonth(l.getMonth()+1),l.setDate(0);var s=o+"~"+(Math.floor((l.getDate()-r-1)/7)+1)+"/"+e;return!(holidays.indexOf(s)>-1)}function createNWdaysSeries(t,e){for(var r=[],o=new Date(t),a=0;a<e;a++)o=addNWdays(o,1),r.push(o.getTime()/1e3);return r}function calculate_prediction(t){var e,r,o,a,i,l=slider_p1.getValue(),s=[],_=[],c=initialize_two_dim_array(l,2);if(std_dev=slider_p2.getValue(),"portfolio"==t){var u=daily_track._data[daily_track._data.length-1][0],d=daily_track._data[daily_track._data.length-1][1];$.each(daily_track._data,function(t,e){_.push(numeral(e[3])._value)}),o=vector_mean(_),a=vector_stdev(_),i=o-Math.pow(a,2)/2}else{var m=$.grep(portfolio.info,function(e){return e.Symbol==t});u=m[0].daily_prices[m[0].daily_prices.length-1][0],d=m[0].daily_prices[m[0].daily_prices.length-1][1];o=m[0].daily_growth_mean,a=m[0].daily_growth_std,i=m[0].daily_growth_drift}r=createNWdaysSeries(u,l),e=numeral(d)._value,max_monte=numeral(d)._value,min_monte=numeral(d)._value;for(var p=0;p<l;p++)e=monte_carlo(e,i,a),s.push(e),e>max_monte&&(max_monte=e),e<min_monte&&(min_monte=e),c._data[p][0]=r[p],c._data[p][1]=s[p];sim_counter++,monte_prd_arr._data[sim_counter][0]=sim_counter,monte_prd_arr._data[sim_counter][1]=n(min_monte),monte_prd_arr._data[sim_counter][2]=n(max_monte),monte_prd_arr._data[sim_counter][3]=n(e),monte_prd_arr._data[sim_counter][4]=n(d),monte_prd_arr._data[sim_counter][5]=ps(numeral(e)._value/numeral(d)._value-1);var f,h=[];tickers_history_quotes[t].map(function(t){h.push(t[0])});var g=initialize_two_dim_array((f=h.concat(r)).length,2),y=initialize_two_dim_array(f.length,2),b=h.length;for(p=0;p<b;p++)g._data[p][0]=1e3*tickers_history_quotes[t][p][0],g._data[p][1]=tickers_history_quotes[t][p][1],y._data[p][0]=1e3*tickers_history_quotes[t][p][0],y._data[p][1]=null;y._data[b-1][1]=tickers_history_quotes[t][b-1][1];for(p=0;p<r.length;p++)g._data[p+b][0]=1e3*r[p],g._data[p+b][1]=null,y._data[p+b][0]=1e3*r[p],y._data[p+b][1]=c._data[p][1];predictionChart(g,y,$("#stockSelect1").children("option").filter(":selected").text(),"predictChart")}function calculate_sell_simulator(t){var e,r,o,a,i,l=slider_m1.getValue(),s=[];std_dev=slider_m2.getValue();var _=$.grep(portfolio.info,function(e){return e.Symbol==t}),c=(_[0].daily_prices[_[0].daily_prices.length-slider_m1.getValue()-1][0],_[0].daily_prices[_[0].daily_prices.length-slider_m1.getValue()-1][1]);o=vector_mean(r=_[0].growth_arr.slice(0,_[0].growth_arr.length-slider_m1.getValue())),a=vector_stdev(r),i=o-Math.pow(a,2)/2,e=c,max_monte=c,min_monte=c,s.push(e);for(var u=0;u<l;u++)(e=monte_carlo(e,i,a))>max_monte&&(max_monte=e),e<min_monte&&(min_monte=e),s.push(e);sim_counter++,monte_sim_arr._data[sim_counter][0]=sim_counter,monte_sim_arr._data[sim_counter][1]=n(min_monte),monte_sim_arr._data[sim_counter][2]=n(max_monte),monte_sim_arr._data[sim_counter][3]=n(e),monte_sim_arr._data[sim_counter][4]=_[0].daily_prices[_[0].daily_prices.length-1][1],monte_sim_arr._data[sim_counter][5]=ps(_[0].daily_prices[_[0].daily_prices.length-1][1]/numeral(e)._value-1);var d=initialize_two_dim_array(_[0].daily_prices.length,2),m=initialize_two_dim_array(_[0].daily_prices.length,2),p=_[0].daily_prices.length-slider_m1.getValue()-1;_[0].daily_prices.map(function(t,e){d._data[e][0]=1e3*moment(_[0].daily_prices[e][0]).format("X"),m._data[e][0]=1e3*moment(_[0].daily_prices[e][0]).format("X"),d._data[e][1]=_[0].daily_prices[e][1],m._data[e][1]=e<p?null:s[e-p]});var f=$("#stockSelect1").children("option").filter(":selected").text();predictionChart(d,m,f,"MonteChart")}function get_corralation_table(){var t=[];t=initialize_two_dim_array(portfolio._correlation._data.length,portfolio._correlation._data.length);for(var e=0;e<portfolio._correlation._data.length;e++)for(var r=e;r<portfolio._correlation._data.length;r++)t._data[r][e]=portfolio._correlation._data[r][e];return t._data}function get_corralation_text(t){var e;switch(t){case"background: green;":e="Low Correlation";break;case"background: yellow;":e="Medium Correlation";break;case"background: orange;":e="High Correlation";break;case"background: red;":e="Very Strong Correlation"}return e}function company_name(t){return"portfolio"!=t?$.grep(portfolio.info,function(e){return e.Symbol==t})[0].current_quote["quoteSummary.result.0.price.longName"]:"Portfolio"}function calc_exchange_rate(){var t=[];(t.push($("#f_cur").val()+$("#t_cur").val()),$("#t_sym").text(curSym[$("#t_cur").val()]),get_Rate_Exchange(t,"rates"),currency_history_obj[t[0]])?(two_dim_arr=[],two_dim_arr=currency_history_obj[t[0]],tb_rx&&(tb_rx.destroy(),$("#rxTB").empty()),create_table("_rate_exchange"),$("#rxChart").empty(),rate_exchange_chart(t[0].substring(0,3)+" "+t[0].substring(3,6),"rxChart")):get_pairRxHistory(t)}function hide_pf(){$("#tblPortfolioM_wrapper thead tr th:nth-child(17)").css("display","none"),$("#tblPortfolioM_wrapper tbody tr td:nth-child(17)").css("display","none"),$(".dataTables_scrollFoot table tfoot tr th:nth-child(17)").css("display","none")}function reset_quote(){$(".stock_info_txt").text(""),$("#add2portfolio").hide(),$("#quote_tbl tbody").empty(),$("#SymbolChart").empty(),$("#symbol_name").empty(),$("#exchange_info").empty()}function reset_portfolio(){portfolio_ready=!1,$("#tblPortfolioM_wrapper thead tr th:nth-child(17)").css("display","none"),$("#tblPortfolioM_wrapper tbody tr td:nth-child(17)").css("display","none"),$(".dataTables_scrollFoot table tfoot tr th:nth-child(17)").css("display","none"),$("#buildPortfolio").removeAttr("disabled"),$("#buildPortfolio").addClass("btn btn-success"),$("#buildPortfolio").text("Analyse Portfolio"),$("#buildPortfolio i").remove(),$("#remove_rec").css("visibility","hidden")}function currency_denominator(t){return"GBp"==t||"GBP"==t?100:1}function download_csv(t,e){var r,o;r=new Blob([t],{type:"text/csv"}),(o=document.createElement("a")).download=e,o.href=window.URL.createObjectURL(r),o.style.display="none",document.body.appendChild(o),o.click()}function export_table_to_csv(t,e){for(var r=[],o=document.querySelectorAll(t+" table tr"),a=0;a<o.length;a++){for(var i=[],n=o[a].querySelectorAll(t+" td, th"),l=0;l<n.length;l++)i.push('"'+n[l].innerText+'"');r.push(i.join(","))}download_csv(r.join("\n"),e)}function makeTable(t,e,r){var o=$("<table/>");t.append(o),$(o).append("<thead><tr></tr></thead>");var a=t.selector+" > table > thead > tr:first";$thead=$(a);for(var i=0,n=r.length;i<n;i++)$thead.append("<th>"+r[i]+"</th>");if($.each(e,function(t,e){var r=$("<tr/>");$.each(e,function(t,e){r.append($("<td/>").text(round_to(e,4)||e))}),o.append(r)}),"#weightsTB"==t.selector){o.append("<tfoot><tr><th>Average Return (p/m):</th><th></th><th></th><th></th></tr><tr><th>Risk:</th><th></th><th></th><th></th></tr><tr><th>Efficiency:</th><th></th><th></th><th></th></tr></tfoot>")}t.append('<br><button id="save_portfolio" type="button" class="btn btn-info">Download CSV<span class="glyphicon glyphicon-save" aria-hidden="true"></span></button>'),$("#save_portfolio").on("click",function(t){alert("start download");var r="#"+$(this).parent().attr("id");switch(r){case"#monthlyTB":case"#returnTB":case"#correlationTB":case"#covarianceTB":case"#weightsTB":case"#indicatorsTB":case"#monteTB":export_table_to_csv(r,"data.csv");break;case"#dailyTB":case"#daily_returnTB":case"#trackTB":case"#rxTB":download_array_2_csv(e)}})}function appendTableColumn(t,e){var r=$("<tr/>").appendTo(t.find("tbody:last"));return $.each(e,function(t,e){r.append($("<td/>").text(round_to(e,4)||e+"%"))}),r}function getTableData(t){var e=[];return t.find("tr").each(function(t,r){var o=[];$(this).find("th,td").each(function(t,e){o.push(e.textContent)}),e.push(o)}),e}function create_table(t){var e=[],r=[];switch(data=[],t){case"_history_d":(r=portfolio._ticker_list.map(function(t){return t})).unshift("Date"),data=combine_price._data,data=jStat.transpose(data),makeTable($("#dailyTB"),data,r),tb_day=$("#dailyTB table").DataTable({responsive:!0,scrollX:!0,scrollY:"600px",scrollCollapse:!0});break;case"_history_m":e=portfolio._date_ragne_arr.map(function(t){return t}),(r=portfolio._ticker_list.map(function(t){return t})).unshift("Date"),data=portfolio.info.map(function(t){return t}).map(function(t){return t.range_vector_arr}),data.unshift(e),data=jStat.transpose(data),makeTable($("#monthlyTB"),data,r),tb_mon=$("#monthlyTB table").DataTable({paging:!1,info:!1,searching:!1,responsive:!0,scrollX:!0,scrollY:"500px",scrollCollapse:!0}),data.unshift(r);break;case"_daily_returns":(r=portfolio._ticker_list.map(function(t){return t})).unshift("Date"),data=combine_return._data,data=jStat.transpose(data),makeTable($("#daily_returnTB"),data,r),tb_Dret=$("#daily_returnTB table").DataTable({responsive:!0,scrollX:!0,scrollY:"600px",scrollCollapse:!0}),data.unshift(r);break;case"_returns":data=[],(e=portfolio._date_ragne_arr).shift(),(r=portfolio._ticker_list.map(function(t){return t})).unshift("Date"),data=initialize_two_dim_array(portfolio._returns._data.length,portfolio._returns._data[0].length),$.each(portfolio._returns._data,function(t,e){$.each(e,function(e,r){data._data[t][e]=p(r)})}),data._data.unshift(e),data._data=jStat.transpose(data._data),makeTable($("#returnTB"),data._data,r),tb_ret=$("#returnTB table").DataTable({paging:!1,info:!1,searching:!1,responsive:!0,scrollX:!0,scrollY:"500px",scrollCollapse:!0}),data._data.unshift(r);break;case"_correlation":(r=portfolio._ticker_list.map(function(t){return t})).unshift("Symbol"),data=get_corralation_table(),data=jStat.transpose(data),data.unshift(portfolio._ticker_list),data=jStat.transpose(data),makeTable($("#correlationTB"),data,r),$("#correlationTB table tr td").off("click"),tb_cor=$("#correlationTB table").DataTable({paging:!1,ordering:!1,info:!1,searching:!1,scrollX:!0}),data.unshift(r),$("#correlationTB table tr td").on("click",function(){var t,e,r=$("<div></div>"),o=[],a=$(this).parent().children().index($(this)),i=$(this).parent().parent().children().index($(this).parent());$(this).attr("style")&&(o=corralation_arr(t=portfolio.info[a-1],e=portfolio.info[i]),r.append(get_corralation_text($(this).attr("style"))+" between "+t.current_quote["quoteSummary.result.0.price.longName"]+"<br>and:<br>"+e.current_quote["quoteSummary.result.0.price.longName"]+". <br><br>Comparing the two assests:<br><br>"),$div2=$('<div id="c1"></div>'),inject_table(o._data,$div2),r.append($div2),dialog("Correlation Info: Compare Assets",r,BootstrapDialog.TYPE_INFO))});break;case"_covariance":(r=portfolio._ticker_list.map(function(t){return t})).unshift("Symbol"),data=portfolio._covariance._data,data=jStat.transpose(data),data.unshift(portfolio._ticker_list),data=jStat.transpose(data),makeTable($("#covarianceTB"),data,r),tb_cov=$("#covarianceTB table").DataTable({paging:!1,ordering:!1,info:!1,searching:!1,scrollX:!0}),data.unshift(r);break;case"_stock_indicators":(r=indicator_arr).unshift("Symbol"),data=portfolio_indicator._data.map(function(t){return t}),makeTable($("#indicatorsTB"),data,r),tb_ind=$("#indicatorsTB table").DataTable({paging:!1,info:!1,searching:!1,scrollX:!0}),data.unshift(r);break;case"_weight_optim":r=["Symbol","Current Weights","Equal Weights","Optimized Weights","Buy/Sell"],data=weight_arr._data.map(function(t){return t}),makeTable($("#weightsTB"),data,r),tb_wgt=$("#weightsTB table").DataTable({paging:!1,info:!1,searching:!1}),data.unshift(r);break;case"_monte_carlo":r=["Symbol","Days Back","fluctuation","Strike Price","Strike Date","Max Predicted Price","Min Predicted Price","Recent Price","Recent Price Date","Sell?"],data=monte_carlo_arr._data.map(function(t){return t}),makeTable($("#monteTB"),data,r),tb_mcarlo=$("#monteTB table").DataTable({paging:!1,info:!1,searching:!1}),data.unshift(r);break;case"_daily_tracking":r=["Date","Total Portfolio","Change from Last Trade"," Change in %"],data=daily_track._data,makeTable($("#trackTB"),data,r),tb_trk=$("#trackTB table").DataTable({paging:!0,info:!0,searching:!1,responsive:!0,scrollY:"500px",scrollCollapse:!0}),symbol_data2("portfolio","trackChart");break;case"_rate_exchange":r=["Date","Close","High","Low","Volume","Open"],data=two_dim_arr,makeTable($("#rxTB"),data,r),tb_rx=$("#rxTB table").DataTable({paging:!0,info:!0,searching:!1,responsive:!0,scrollY:"500px",scrollCollapse:!0})}}function download_array_2_csv(t){var e="data:text/csv;charset=utf-8,";t.forEach(function(r,o){dataString='"'+r.join(",")+'"',e+=o<t.length?dataString+"\n":dataString});var r=encodeURI(e),o=document.createElement("a");o.setAttribute("href",r),o.setAttribute("download","data.csv"),document.body.appendChild(o),o.click()}function inject_table(t,e){var r=$("<table />");r[0].border="1";for(var o=t[0].length,a=$(r[0].insertRow(-1)),i=0;i<o;i++){var n=$("<th />");n.html(t[0][i]),a.append(n)}for(i=1;i<t.length;i++){a=$(r[0].insertRow(-1));for(var l=0;l<o;l++){var s=$("<td />");s.html(t[i][l]),a.append(s)}}var _=$(e);_.html(""),_.append(r)}function corralation_arr(t,e){var r=[];return(r=initialize_two_dim_array(3,4))._data[0][0]="Company",r._data[0][1]="Growth",r._data[0][2]="Risk",r._data[0][3]="Efficiency",r._data[1][0]=t.current_quote["quoteSummary.result.0.price.longName"],r._data[1][1]=p(t.growth_mean),r._data[1][2]=p(t.growth_std),r._data[1][3]=n(t.s_ratio),r._data[2][0]=e.current_quote["quoteSummary.result.0.price.longName"],r._data[2][1]=p(e.growth_mean),r._data[2][2]=p(e.growth_std),r._data[2][3]=n(e.s_ratio),r}function sparkChart(t,e){var r=[];r=initialize_two_dim_array(tickers_history_quotes[t].length,2),tickers_history_quotes[t].map(function(t,e){r._data[e][0]=1e3*t[0]}),tickers_history_quotes[t].map(function(t,e){r._data[e][1]=t[1]}),Highcharts.chart(e,{title:{text:""},xAxis:{type:"datetime"},yAxis:{title:{text:"Price"}},legend:{enabled:!1},plotOptions:{area:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,Highcharts.getOptions().colors[0]],[1,Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get("rgba")]]},marker:{radius:2},lineWidth:1,states:{hover:{lineWidth:1}},threshold:null}},series:[{type:"area",data:r._data}]})}function symbol_data2(t,e){var r=[];r=initialize_two_dim_array(tickers_history_quotes[t].length,2),tickers_history_quotes[t].map(function(t,e){r._data[e][0]=1e3*t[0]}),tickers_history_quotes[t].map(function(t,e){r._data[e][1]=t[1]}),Highcharts.stockChart(e,{rangeSelector:{selected:1},title:{text:t+" historic prices"},scrollbar:{barBackgroundColor:"gray",barBorderRadius:7,barBorderWidth:0,buttonBackgroundColor:"gray",buttonBorderWidth:0,buttonBorderRadius:7,trackBackgroundColor:"none",trackBorderWidth:1,trackBorderRadius:8,trackBorderColor:"#CCC"},series:[{name:"Price",data:r._data,tooltip:{valueDecimals:2}}]})}function rate_exchange_chart(t,e){var r=[];r=initialize_two_dim_array(two_dim_arr.length,2),two_dim_arr.map(function(t,e){r._data[e][0]=numeral(moment(t[0]).format("x"))._value}),two_dim_arr.map(function(t,e){r._data[e][1]=t[1]}),Highcharts.stockChart(e,{rangeSelector:{selected:1},title:{text:t+" historic prices"},scrollbar:{barBackgroundColor:"gray",barBorderRadius:7,barBorderWidth:0,buttonBackgroundColor:"gray",buttonBorderWidth:0,buttonBorderRadius:7,trackBackgroundColor:"none",trackBorderWidth:1,trackBorderRadius:8,trackBorderColor:"#CCC"},series:[{name:"Price",data:r._data,tooltip:{valueDecimals:2}}]})}function predictionChart(t,e,r,o){Highcharts.stockChart(o,{rangeSelector:{selected:1},title:{text:r+" : Prediction"},scrollbar:{barBackgroundColor:"gray",barBorderRadius:7,barBorderWidth:0,buttonBackgroundColor:"gray",buttonBorderWidth:0,buttonBorderRadius:7,trackBackgroundColor:"none",trackBorderWidth:1,trackBorderRadius:8,trackBorderColor:"#CCC"},series:[{name:"History",data:t._data,tooltip:{valueDecimals:2}},{name:"Prediction",data:e._data,tooltip:{valueDecimals:2}}]})}function risk_chart(t,e,r){chartGrowth&&chartGrowth.series[0].points[0].update(t),chartRisk&&chartRisk.series[0].points[0].update(e),chartEfficiency&&chartEfficiency.series[0].points[0].update(r)}function create_chart_container_for(t,e){var r='<div><h4 class="perfCompany">'+company_name(t)+'</h4></div><div class="row perfDiv"><div class="perfItem col-md-4" id="container-growth-'+t+'" "></div><div class="perfItem col-md-4" id="container-risk-'+t+'" "></div><div class="perfItem col-md-4" id="container-efficiency-'+t+'" ></div></div>';containerGrowth="container-growth-"+t,containerRisk="container-risk-"+t,containerEfficiency="container-efficiency-"+t,$(e).append(r),chartGrowth=Highcharts.chart(containerGrowth,Highcharts.merge(gaugeOptions,{yAxis:{min:-10,max:10,title:{text:"Growth"}},credits:{enabled:!1},series:[{name:"Growth",data:[0],dataLabels:{format:'<div class="perfReading" ><span style="font-size:25px;color:'+(Highcharts.theme&&Highcharts.theme.contrastTextColor||"black")+'">{y:.1f}</span><br/><span class="perfSubTitle">% Per Month</span></div>'},tooltip:{valueSuffix:"% per/month"}}]})),chartRisk=Highcharts.chart(containerRisk,Highcharts.merge(riskOptions,{yAxis:{min:0,max:20,title:{text:"Risk"}},series:[{name:"Risk",data:[.1],dataLabels:{format:'<div class="perfReading" ><span style="font-size:25px;color:'+(Highcharts.theme&&Highcharts.theme.contrastTextColor||"black")+'">{y:.1f}</span><br/><span class="perfSubTitle">% Standard Deviation</span></div>'},tooltip:{valueSuffix:"% Standard Deviation"}}]})),chartEfficiency=Highcharts.chart(containerEfficiency,Highcharts.merge(gaugeOptions,{yAxis:{min:-5,max:5,title:{text:"Efficiency"}},series:[{name:"S-ratio",data:[0],dataLabels:{format:'<div class="perfReading"><span style="font-size:25px;color:'+(Highcharts.theme&&Highcharts.theme.contrastTextColor||"black")+'">{y:.1f}</span><br/><span class="perfSubTitle">Sharpe Ratio</span></div>'},tooltip:{valueSuffix:"Sharpe Ratio"}}]}))}function portfolio_dist_pie_chart(t,e,r){Highcharts.chart(t,{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:e},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{name:"Symbol",colorByPoint:!0,data:r}]})}function CompareAssetsChart(){$.each(chart_symbols,function(t,e){var r=[];r=initialize_two_dim_array(tickers_history_quotes[e].length,2),tickers_history_quotes[e].map(function(t,e){r._data[e][0]=1e3*t[0]}),tickers_history_quotes[e].map(function(t,e){r._data[e][1]=t[1]}),seriesCounter=t,seriesOptions[seriesCounter]={name:e,data:r._data}}),createCompareChartPercent(),seriesCounter=0,seriesOptions=[]}function createCompareChartPercent(){Highcharts.stockChart("chart",{rangeSelector:{selected:4},yAxis:{labels:{formatter:function(){return(this.value>0?" + ":"")+this.value+"%"}},plotLines:[{value:0,width:2,color:"silver"}]},plotOptions:{series:{compare:"percent",showInNavigator:!0}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',valueDecimals:2,split:!0},series:seriesOptions})}function optimize_portfolio(){var t,e,r=[],o=[],a=0,i=0,n={};a=t=portfolio._std_dev,i=e=portfolio._mean,portfolio._s_Ratio,n._weight=portfolio._wgt_arr._data,n._solved=!1,n._target_std=t,n._target_return=e;for(var l=0;l<1e3;l++)(r=Array.apply(null,Array(portfolio._count_tickers-1)).map(function(){return Math.random()})).push(0,1),r.sort(),(o=r.map(function(t,e,r){return r[e+1]-r[e]})).splice(portfolio._count_tickers,1),a=portfolio_stdev(portfolio._covariance._data,o),i=math.multiply(portfolio._mean_arr,o),a<=n._target_std&&i>n._target_return&&(n._target_std=a,n._target_return=i,n._s_ratio=(i-.001)/a,n._solved=!0,n._weight=o),r=[],o=[];return n}function eq_balance_portfolio(t){var e,r,o={};return e=portfolio_stdev(portfolio._covariance._data,t),r=math.multiply(portfolio._mean_arr,t),o._target_std=e,o._target_return=r,o._s_ratio=(r-.001)/e,o._solved=!0,o._weight=t,o}